databaseChangeLog:
  - changeSet:
      id: tenant-004-create-orders
      author: kanghouchao
      preConditions:
        - dbms:
            type: postgresql
      changes:
        - createTable:
            tableName: t_orders
            remarks: 订单表
            columns:
              - column:
                  name: id
                  type: VARCHAR(64)
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_t_orders
              - column:
                  name: tenant_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: store_name
                  type: VARCHAR(255)
                  remarks: 店铺名
              - column:
                  name: receptionist_id
                  type: VARCHAR(64)
                  remarks: 接待人员ID (关联 t_users)
              - column:
                  name: business_date
                  type: DATE
                  constraints:
                    nullable: false
                  remarks: 营业日
              - column:
                  name: arrival_scheduled_start_time
                  type: TIME
                  remarks: 预定到达开始时间
              - column:
                  name: arrival_scheduled_end_time
                  type: TIME
                  remarks: 预定到达结束时间
              - column:
                  name: customer_id
                  type: VARCHAR(64)
                  remarks: 顾客ID
              - column:
                  name: girl_id
                  type: VARCHAR(64)
                  remarks: 女生ID
              - column:
                  name: course_minutes
                  type: INTEGER
                  remarks: 课程分钟数
              - column:
                  name: extension_minutes
                  type: INTEGER
                  defaultValueNumeric: 0
                  remarks: 延长分钟数
              - column:
                  name: option_codes
                  type: JSONB
                  defaultValueComputed: "'[]'::jsonb"
                  remarks: 选项代码列表 (JSON Array)
              - column:
                  name: discount_name
                  type: VARCHAR(255)
                  remarks: 折扣名称
              - column:
                  name: manual_discount
                  type: INTEGER
                  defaultValueNumeric: 0
                  remarks: 手动折扣金额
              - column:
                  name: carrier
                  type: VARCHAR(100)
                  remarks: 运营商/Carrier
              - column:
                  name: media_name
                  type: VARCHAR(100)
                  remarks: 媒体名称
              - column:
                  name: used_points
                  type: INTEGER
                  defaultValueNumeric: 0
                  remarks: 使用积分
              - column:
                  name: manual_grant_points
                  type: INTEGER
                  defaultValueNumeric: 0
                  remarks: 手动赋予积分
              - column:
                  name: remarks
                  type: TEXT
                  remarks: 备注
              - column:
                  name: girl_driver_message
                  type: TEXT
                  remarks: 给女生/司机的留言
              - column:
                  name: status
                  type: VARCHAR(50)
                  defaultValue: 'CREATED'
                  remarks: 订单状态
              - column:
                  name: created_at
                  type: TIMESTAMP WITH TIME ZONE
                  defaultValueComputed: CURRENT_TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: TIMESTAMP WITH TIME ZONE
                  defaultValueComputed: CURRENT_TIMESTAMP
                  constraints:
                    nullable: false

        - addForeignKeyConstraint:
            constraintName: fk_t_orders_tenant
            baseTableName: t_orders
            baseColumnNames: tenant_id
            referencedTableName: central_tenants
            referencedColumnNames: id
            onDelete: CASCADE

        - addForeignKeyConstraint:
            constraintName: fk_t_orders_receptionist
            baseTableName: t_orders
            baseColumnNames: receptionist_id
            referencedTableName: t_users
            referencedColumnNames: id
            onDelete: SET NULL

        - addForeignKeyConstraint:
            constraintName: fk_t_orders_customer
            baseTableName: t_orders
            baseColumnNames: customer_id
            referencedTableName: t_customers
            referencedColumnNames: id
            onDelete: RESTRICT

        - addForeignKeyConstraint:
            constraintName: fk_t_orders_girl
            baseTableName: t_orders
            baseColumnNames: girl_id
            referencedTableName: t_girls
            referencedColumnNames: id
            onDelete: RESTRICT

        - createIndex:
            indexName: idx_t_orders_date
            tableName: t_orders
            columns:
              - column:
                  name: business_date
              - column:
                  name: tenant_id

        - createIndex:
            indexName: idx_t_orders_customer
            tableName: t_orders
            columns:
              - column:
                  name: customer_id

        - createIndex:
            indexName: idx_t_orders_girl
            tableName: t_orders
            columns:
              - column:
                  name: girl_id
